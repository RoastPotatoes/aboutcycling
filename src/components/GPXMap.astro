---
import { onMount } from "solid-js";

const { gpxFile } = Astro.props;

onMount(() => {
  // Log the passed GPX file
  if (!gpxFile) {
    console.error("GPX file path is missing or not passed to GPXMap component.");
    return;
  }
  console.log("GPX file received by GPXMap:", gpxFile);

  // Wait for the DOM to be ready
  document.addEventListener("DOMContentLoaded", () => {
    // Ensure Leaflet is loaded
    if (typeof L === "undefined") {
      console.error("Leaflet library is not loaded.");
      return;
    }

    const mapContainer = document.getElementById("map");
    if (!mapContainer) {
      console.error("Map container with id 'map' not found.");
      return;
    }

    const map = L.map("map").setView([51.505, -0.09], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
    }).addTo(map);

    new L.GPX(gpxFile, {
      async: true,
      marker_options: {
        startIconUrl: "/leaflet-icons/pin-icon-start.png",
        endIconUrl: "/leaflet-icons/pin-icon-end.png",
        shadowUrl: "/leaflet-icons/pin-shadow.png",
      },
    })
      .on("loaded", (e) => {
        console.log("GPX file successfully loaded:", gpxFile);
        map.fitBounds(e.target.getBounds());
      })
      .on("error", (e) => {
        console.error("Error loading GPX file:", e);
      })
      .addTo(map);
  });
});
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/2.1.0/gpx.min.js" defer></script>

<div id="map" style="width: 100%; height: 500px;"></div>
